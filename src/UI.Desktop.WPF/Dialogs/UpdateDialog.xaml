<Window x:Class="UI.Desktop.WPF.Dialogs.UpdateDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:Input="clr-namespace:CommunityToolkit.Mvvm.Input"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:dvm="clr-namespace:Logic.UI.DialogViewModels;assembly=Logic.UI"
        xmlns:local="clr-namespace:UI.Desktop.WPF.Dialogs"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:md="https://github.com/fantasticfiasco/mvvm-dialogs"
        Title="Update"
        MinWidth="640"
        MinHeight="400"
        d:DataContext="{d:DesignInstance Type=dvm:UpdateDialogViewModel}"
        md:DialogServiceViews.IsRegistered="True"
        ResizeMode="NoResize"
        SizeToContent="WidthAndHeight"
        WindowStartupLocation="CenterOwner"
        mc:Ignorable="d">
  <Window.InputBindings>
    <KeyBinding Key="Esc"
                Command="{Binding CancelCommand}" />
  </Window.InputBindings>
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>
    <StackPanel Orientation="Vertical">
      <TextBlock Text="Current Pinboard file date:" />
      <TextBlock FontWeight="Bold"
                 Text="{Binding CurrentFile.DateStr}" />
      <Separator />
      <Label Content="The new Pinboard.in backup file will be downloaded from:"
             Visibility="{Binding HasURL,
                                  Converter={StaticResource BoolVisibilityConverter}}" />
      <Label x:Name="tbxJSONFileURL"
             Content="{Binding JSONFileURL,
                               Mode=OneWay}"
             Focusable="True"
             FontStyle="Italic"
             IsTabStop="True"
             Visibility="{Binding HasURL,
                                  Converter={StaticResource BoolVisibilityConverter}}" />
      <Label Content="No download URL set!"
             FontWeight="Bold"
             Foreground="Red"
             Visibility="{Binding HasURL,
                                  Converter={StaticResource BoolInverseVisibilityConverter}}" />
      <Label Content="Download URL can be changed in settings." />
      <Button Input:RelayCommandExtensions.IsCommandUpdateEnabled="True"
              Command="{Binding DownloadCommand}"
              Content="Download" />
      <TextBlock FontWeight="Bold"
                 Text="Download failed."
                 Visibility="{Binding HasDownloadFailed,
                                      Converter={StaticResource BoolVisibilityConverter}}" />
      <TextBlock FontWeight="Bold"
                 Text="Try to change the URL in settings and download again."
                 Visibility="{Binding HasDownloadFailed,
                                      Converter={StaticResource BoolVisibilityConverter}}" />
      <TextBlock FontWeight="Bold"
                 Text="Download succeeded."
                 Visibility="{Binding HasDownloadSucceeded,
                                      Converter={StaticResource BoolVisibilityConverter}}" />
      <TextBlock FontWeight="Bold"
                 Text="Click on `Save` to apply the new data file."
                 Visibility="{Binding HasDownloadSucceeded,
                                      Converter={StaticResource BoolVisibilityConverter}}" />
    </StackPanel>
    <StackPanel Grid.Row="1"
                Margin="0 6 3 0"
                HorizontalAlignment="Right"
                Orientation="Horizontal">

      <Button Input:RelayCommandExtensions.IsCommandUpdateEnabled="True"
              Command="{Binding SaveCommand}"
              Content="Save" />

      <Button Input:RelayCommandExtensions.IsCommandUpdateEnabled="True"
              Command="{Binding CancelCommand}"
              Content="Cancel" />
    </StackPanel>

  </Grid>
</Window>
